# Popug Task Manager

### MindMap:
[Miro](https://miro.com/app/board/uXjVPVXM5Yk=/?share_link_id=879903306597)

![](ptm.jpg)

## План

### 1. AUTH
- JWT на основе формы клюва
- Форма клюва
- Имя (Кеша - Админ, Глаша - Бухгалтер, Гоша - Менеджер, Шуша, Бляша, Хрюша)
- Роль (менеджер, администратор, обычный)

### 2. API
- Вход для всех попугов
- Method: Создание задачи:
  - (*) описание
  - (*) статус (выполнена или нет)
  - (*) исполнитель (назначить можно на любого кроме менеджеров и админов)
  - Цены (определяются сервисом Accounting)
- Method: Reassign tasks (для менеджеров и администраторов):
  - Все "открытые" задачи рандомно назначаются на рандомного исполнителя (кроме менеджера и администратора)
  - Назначать задачу можно на кого угодно, кроме менеджера и администратора
- Method: Список своих задач
- Method: Список всех задач (для менеджеров и администраторов)
- Method: Отметить свою задачу выполненной

#### Events:
- Создание задачи
- Назначение исполнителя (при Reassign)
- Отметка задачи выполненной

### 3. Accounting

- Вход для обычных попугов:
  - Method: Текущий баланс
  - Method: Баланс за сегодня
  - Method: Лог операций


- Вход для админов и бухгалтеров:
  - Method: Текущий баланс компании
  - Method: Баланс компании за сегодня
  - Method: Статистика по дням

- Логи:
  - Лог операций по балансам
    - Дата
    - Пользователь
    - Операция
    - Сумма
  - Лог балансов компании по дням
    - Дата
    - Сумма

#### Events Handling:
- Изменение баланса:
  - Запись в лог

- Создание задачи:
  - цена принятия для исполнителя: rand(10..20)$
  - цена награды для исполнителя: rand(20..40)$
  - с исполнителя списывается цена принятия

- Назначение исполнителя:
  - предыдущему исполнителю возвращается цена принятия
  - с нового исполнителя списывается цена принятия

- Отметка задачи выполненной
  - исполнителю начисляется цена награды

- Конец дня
  - Посчитать балансы по сотрудникам
    - Если баланс положительный, "выплатить" (обнулить)
    - "Отправить письмо"
  - Посчитать баланс компании за день:
    - (sum(completed task price) - sum(assigned task fee) * -1
    - (сумма всех закрытых и открытых задач за день с противоположным знаком)

### 4. Analytics

- Вход - для админов
- Сколько заработал топ-менеджмент за сегодня
- Сколько попугов ушло в минус
- Самая дорогая задача (из закрытых) за день, неделю, месяц
